{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PATIENT</title>
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" />
    
    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    
    <style>
        /* Base styles */
        * { margin: 0; padding: 0; box-sizing: border-box; list-style: none; font-family: 'Josefin Sans', sans-serif; }
        body { background-color: #f3f5f9; }
        .bg-danger { background-color: #ff0018 !important; }
        
        /* Sidebar styling */
        .wrapper { display: flex; position: relative; }
        .wrapper .sidebar {
            width: 250px;
            height: 100vh;
            background: #111010;
            padding: 30px 0;
            position: fixed;
            top: 60px; /* below navbar */
            box-shadow: 2px 0 5px rgba(0,0,0,0.2);
        }
        .wrapper .sidebar h2 {
            color: #fff;
            text-transform: uppercase;
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.5em;
        }
        .wrapper .sidebar ul li {
            padding: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .wrapper .sidebar ul li a {
            color: #fff;
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
            font-weight: 500;
        }
        .wrapper .sidebar ul li a .fas {
            width: 30px;
            margin-right: 10px;
            font-size: 1.2em;
            color: #ff0018;
        }
        .wrapper .sidebar ul li:hover {
            background-color: #594f8d;
        }
        .wrapper .sidebar ul li:hover a {
            color: #fff;
        }
        .wrapper .main_content {
            width: 100%;
            margin-left: 250px;
            padding: 20px;
            min-height: 100vh;
            background: #fff;
        }
        
        /* Navbar profile image */
        .navbar-nav .nav-link img {
            width: 30px;
            height: 30px;
            object-fit: cover;
            margin-right: 10px;
            border-radius: 50%;
            border: 1.5px solid #fff;
        }
        
        /* Notification bell shake animation */
        @keyframes shake {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(15deg); }
            50% { transform: rotate(-15deg); }
            75% { transform: rotate(15deg); }
            100% { transform: rotate(0deg); }
        }
        .shake {
            animation: shake 0.5s infinite;
        }
        
        /* Messages container spacing */
        .messages-container {
            max-width: 900px;
            margin: 20px auto;
        }
        
        /* Notification badge positioning */
        .notification-badge {
            position: absolute;
            top: 0;
            right: 0;
            font-size: 0.6rem;
            transform: translate(50%, -50%);
        }
    </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top bg-danger">
    <a class="navbar-brand text-white" href="/">
        <i class="fas fa-user-injured"></i>&nbsp;
        <span style="font-family: 'Comic Sans MS'; font-size: 1.2em;">PATIENT ACCOUNT</span>
    </a>
    
    <div class="collapse navbar-collapse w-100 order-3 dual-collapse2" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto">

            <!-- Notification Bell -->
            <li class="nav-item">
                <a class="nav-link position-relative text-white" href="{% url 'patient-notifications' %}" title="Notifications" aria-label="Notifications">
                    <i class="fas fa-bell {% if unread_count > 0 %}shake{% endif %}"></i>
                    {% if unread_count > 0 %}
                        <span class="badge badge-danger notification-badge">{{ unread_count }}</span>
                    {% endif %}
                </a>
            </li>

            <!-- Profile Dropdown -->
            {% if request.user.is_authenticated and request.user.patient %}
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle text-white" href="#" id="patientDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    {% if request.user.patient.profile_pic %}
                        <img src="{{ request.user.patient.profile_pic.url }}" alt="Profile Picture">
                    {% else %}
                        <img src="{% static 'images/default-avatar.jpg' %}" alt="Default Avatar">
                    {% endif %}
                    <i class="fas fa-user-circle"></i>
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="patientDropdown">
                    <a class="dropdown-item" href="{% url 'patient-profile' patient_id=request.user.patient.id %}">View Profile</a>
                    <a class="dropdown-item" href="{% url 'patient-edit-profile' patient_id=request.user.patient.id %}">Edit Profile</a>
                    <a class="dropdown-item" href="{% url 'patient-change-password' %}">Change Password</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item text-danger" href="{% url 'logout' %}">Logout</a>
                </div>
            </li>
            {% endif %}

        </ul>
    </div>
</nav>

<!-- Messages container -->
<div class="messages-container">
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
      {% endfor %}
    {% endif %}
</div>

<!-- Main Wrapper -->
<div class="wrapper">

    <!-- Sidebar -->
    <div class="sidebar">
        <h2>Menu</h2>
        <ul>
            <li><a href="/"><i class="fas fa-house"></i> Home</a></li>
            <li><a href="/patient/make-request"><i class="fas fa-tint"></i> Make Request</a></li>
            <li><a href="/patient/my-request"><i class="fas fa-clock"></i> Blood Requests
                {% if unread_count > 0 %}
                    <span class="badge badge-danger ml-1">{{ unread_count }}</span>
                {% endif %}
            </a></li>
            
            <li><a href="{% url 'patient-blood-stock-tracker' %}"><i class="fas fa-droplet"></i> Blood Stock Tracker</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main_content">
        <div class="content-area">
            {% block content %}
            <!-- Page specific content will be shown here -->
            {% endblock %}
        </div>
    </div>

</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

</body>
</html>
