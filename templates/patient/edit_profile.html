{% extends 'patient/patientbase.html' %}
{% load widget_tweaks %}

{% block content %}
<div class="container mt-4">
    <h2>Edit Profile</h2>

    <!-- Display Django messages -->
    {% if messages %}
      <div class="mt-3">
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        
        {% for field in form %}
            <div class="form-group">
                <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                {{ field|add_class:"form-control" }}
                {% if field.help_text %}
                    <small class="form-text text-muted">{{ field.help_text }}</small>
                {% endif %}
                {% if field.errors %}
                    <div class="text-danger">{{ field.errors }}</div>
                {% endif %}
            </div>
        {% endfor %}

        <!-- Optional: Button to update current location -->
        <button type="button" id="update-location-btn" class="btn btn-info mb-3">Update Current Location</button>

        <button type="submit" class="btn btn-primary">Save Changes</button>
    </form>
</div>

<!-- JavaScript: Geolocation for Update Current Location -->
<script>
    document.getElementById('update-location-btn').addEventListener('click', function() {
        if (!navigator.geolocation) {
            alert('Geolocation is not supported by your browser');
            return;
        }

        navigator.geolocation.getCurrentPosition(function(position) {
            // Update hidden inputs for latitude and longitude
            document.getElementById('id_latitude').value = position.coords.latitude;
            document.getElementById('id_longitude').value = position.coords.longitude;
            alert('Your current location has been updated. Please save the form to persist changes.');
        }, function() {
            alert('Unable to retrieve your location.');
        });
    });
</script>
{% endblock %}
